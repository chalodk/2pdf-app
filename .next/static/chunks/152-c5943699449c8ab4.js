"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[152],{3152:function(e,a,t){t.d(a,{Z:function(){return N}});var n=t(5893),s=t(7294);function r(e){let{activeTab:a,onTabChange:t}=e;return(0,n.jsx)("div",{className:"tabs",children:["HTML","CSS","Data"].map(e=>(0,n.jsx)("button",{className:"tab ".concat(a===e?"active":""),onClick:()=>t(e),children:e},e))})}var i=t(3764);function o(e){let{value:a,onChange:t}=e;return(0,n.jsx)(i.ZP,{height:"100%",language:"html",theme:"vs-dark",value:a,onChange:t,options:{minimap:{enabled:!1},fontSize:14,wordWrap:"on",automaticLayout:!0}})}function c(e){let{value:a,onChange:t}=e;return(0,n.jsx)(i.ZP,{height:"100%",language:"css",theme:"vs-dark",value:a,onChange:t,options:{minimap:{enabled:!1},fontSize:14,wordWrap:"on",automaticLayout:!0}})}function l(e){let{value:a,onChange:t}=e;return(0,n.jsx)(i.ZP,{height:"100%",language:"json",theme:"vs-dark",value:a,onChange:t,onValidate:e=>{},options:{minimap:{enabled:!1},fontSize:14,wordWrap:"on",automaticLayout:!0,formatOnPaste:!0}})}var d=t(1993);let u='<div class="card">\n  <h1>Hello {{name}}</h1>\n  <p>Email: {{user.email}}</p>\n  <p>{{description}}</p>\n  \n  <h2>Resultados</h2>\n  <ul>\n    {% for resultado in resultados %}\n    <li>{{resultado.titulo}} - {{resultado.valor}}</li>\n    {% endfor %}\n  </ul>\n</div>',h="body {\n  font-family: 'Inter', sans-serif;\n  padding: 20px;\n  background: #f5f5f5;\n}\n\n.card {\n  background: white;\n  padding: 24px;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n}\n\nh1 {\n  color: #2563eb;\n  margin-bottom: 12px;\n}\n\np {\n  color: #64748b;\n  margin: 8px 0;\n}",m=JSON.stringify({name:"Gonzalo",user:{email:"gonzalo@example.com"},description:"Welcome to the template editor!",resultados:[{titulo:"Ventas Q1",valor:"$12,500"},{titulo:"Ventas Q2",valor:"$15,800"},{titulo:"Ventas Q3",valor:"$18,200"}]},null,2),p=(0,d.U)(e=>({html:u,css:h,data:m,setHtml:a=>e({html:a}),setCss:a=>e({css:a}),setData:a=>e({data:a}),applyAIResponse:a=>{let{html:t,css:n,data:s}=a;e({html:t||u,css:n||h,data:s?"string"==typeof s?s:JSON.stringify(s,null,2):m})}}));function f(e,a){return a.split(".").reduce((e,a)=>e?e[a]:"",e)}async function g(e,a,t){try{let n=JSON.parse(t),s=function(e,a){let t=e.replace(/{%\s*for\s+(\w+)\s+in\s+([\w.]+)\s*%}([\s\S]*?){%\s*endfor\s*%}/g,(e,a,t,n)=>"{{#each ".concat(t," as |").concat(a,"|}}").concat(n,"{{/each}}"));return'\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <meta charset="UTF-8">\n        <style>'.concat(a,"</style>\n      </head>\n      <body>\n        ").concat(t,"\n      </body>\n    </html>\n  ")}(e,a),r=await fetch("".concat("http://localhost:3000","/render"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template:s,data:n})});if(!r.ok)throw Error("Error: ".concat(r.status," ").concat(r.statusText));let i=await r.blob(),o=window.URL.createObjectURL(i),c=document.createElement("a");c.href=o,c.download="documento.pdf",document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(o),document.body.removeChild(c)}catch(e){console.error("Error generating PDF:",e),alert("Error al generar el PDF: "+e.message)}}function x(){let[e,a]=(0,s.useState)(""),[t,r]=(0,s.useState)(""),[i,o]=(0,s.useState)(!1),[c,l]=(0,s.useState)(!1),d=(0,s.useRef)(""),u=p(e=>e.html),h=p(e=>e.css),m=p(e=>e.data);(0,s.useEffect)(()=>{l(!0)},[]),(0,s.useEffect)(()=>{if(c){try{var e;let t=JSON.parse(m),n=(e=function e(a,t){let n=a.replace(/{%\s*for\s+(\w+)\s+in\s+([\w.]+)\s*%}([\s\S]*?){%\s*endfor\s*%}/g,(a,n,s,r)=>{let i=f(t,s);return Array.isArray(i)?i.map((a,s)=>e(r,{...t,[n]:a,loop:{index:s}})).join(""):""});return n=n.replace(/{{\s*([\w.]+)\s*}}/g,(e,a)=>{let n=f(t,a);return null!=n?n:""})}(u,t),'\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <meta charset="UTF-8">\n        <style>'.concat(h,"</style>\n      </head>\n      <body>\n        ").concat(e,"\n      </body>\n    </html>\n  "));a(n),d.current&&URL.revokeObjectURL(d.current);let s=new Blob([n],{type:"text/html"}),i=URL.createObjectURL(s);d.current=i,r(i)}catch(e){}return()=>{d.current&&(URL.revokeObjectURL(d.current),d.current="")}}},[u,h,m,c]);let x=async()=>{o(!0);try{await g(u,h,m)}finally{o(!1)}};return c?(0,n.jsxs)("div",{className:"preview-container",children:[(0,n.jsx)("div",{className:"preview-header",children:(0,n.jsx)("button",{className:"generate-pdf-btn",onClick:x,disabled:i,children:i?"Generando...":"Generar PDF"})}),t&&(0,n.jsx)("iframe",{className:"preview-frame",src:t,sandbox:"allow-same-origin allow-scripts allow-popups",title:"Preview"})]}):(0,n.jsxs)("div",{className:"preview-container",children:[(0,n.jsx)("div",{className:"preview-header",children:(0,n.jsx)("button",{className:"generate-pdf-btn",disabled:!0,children:"Cargando..."})}),(0,n.jsx)("div",{className:"preview-frame",style:{display:"flex",alignItems:"center",justifyContent:"center",color:"#8b949e"},children:"Cargando preview..."})]})}var b=t(8029);let v=t(3454).env.NEXT_PUBLIC_N8N_WEBHOOK_URL||"";async function j(e){if(!v)throw Error("Webhook URL not configured. Please set NEXT_PUBLIC_N8N_WEBHOOK_URL");let a=await fetch(v,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e})});if(!a.ok)throw Error("Webhook error: ".concat(a.status," ").concat(a.statusText));return await a.json()}function y(){let[e,a]=(0,s.useState)(""),[t,r]=(0,s.useState)([]),i=p(e=>e.applyAIResponse),o=(0,b.D)({mutationFn:j,onSuccess:t=>{i(t),r(a=>[...a,{type:"user",content:e},{type:"assistant",content:"Template actualizado exitosamente! ✨"}]),a("")},onError:a=>{r(t=>[...t,{type:"user",content:e},{type:"error",content:"Error: ".concat(a.message)}])}});return(0,n.jsxs)("div",{className:"ai-chat-sidebar",children:[(0,n.jsxs)("div",{className:"ai-chat-header",children:[(0,n.jsx)("h3",{children:"AI Assistant"}),(0,n.jsx)("p",{className:"ai-chat-subtitle",children:"Describe tu template y lo generar\xe9 por ti"})]}),(0,n.jsxs)("div",{className:"ai-chat-messages",children:[0===t.length&&(0,n.jsxs)("div",{className:"ai-chat-empty",children:[(0,n.jsx)("p",{children:"Env\xeda un mensaje para comenzar..."}),(0,n.jsx)("p",{className:"ai-chat-example",children:'Ejemplo: "Crea un CV moderno con secciones para experiencia, educaci\xf3n y habilidades"'})]}),t.map((e,a)=>(0,n.jsxs)("div",{className:"ai-chat-message ai-chat-message-".concat(e.type),children:["user"===e.type&&(0,n.jsx)("span",{className:"ai-chat-role",children:"T\xfa:"}),"assistant"===e.type&&(0,n.jsx)("span",{className:"ai-chat-role",children:"AI:"}),"error"===e.type&&(0,n.jsx)("span",{className:"ai-chat-role",children:"Error:"}),(0,n.jsx)("span",{className:"ai-chat-content",children:e.content})]},a)),o.isPending&&(0,n.jsxs)("div",{className:"ai-chat-message ai-chat-message-assistant",children:[(0,n.jsx)("span",{className:"ai-chat-role",children:"AI:"}),(0,n.jsx)("span",{className:"ai-chat-content",children:"Generando template..."})]})]}),(0,n.jsxs)("form",{className:"ai-chat-input-form",onSubmit:t=>{if(t.preventDefault(),e.trim()&&!o.isPending){if(!v){r(a=>[...a,{type:"user",content:e},{type:"error",content:"Webhook URL no configurada. Por favor configura NEXT_PUBLIC_N8N_WEBHOOK_URL"}]),a("");return}o.mutate(e)}},children:[(0,n.jsx)("input",{type:"text",value:e,onChange:e=>a(e.target.value),placeholder:"Describe el template que quieres crear...",disabled:o.isPending,className:"ai-chat-input"}),(0,n.jsx)("button",{type:"submit",disabled:!e.trim()||o.isPending,className:"ai-chat-send-btn",children:o.isPending?"Enviando...":"Enviar"})]})]})}function N(){let[e,a]=(0,s.useState)("HTML"),[t,i]=(0,s.useState)(!0),d=p(e=>e.html),u=p(e=>e.css),h=p(e=>e.data),m=p(e=>e.setHtml),f=p(e=>e.setCss),g=p(e=>e.setData);return(0,n.jsxs)("div",{className:"editor-layout ".concat(t?"with-sidebar":"no-sidebar"),children:[t&&(0,n.jsx)(y,{}),(0,n.jsxs)("div",{className:"left-panel",children:[(0,n.jsxs)("div",{className:"panel-header",children:[(0,n.jsx)(r,{activeTab:e,onTabChange:a}),(0,n.jsx)("button",{className:"ai-toggle-btn",onClick:()=>i(!t),title:t?"Ocultar AI":"Mostrar AI",children:t?"✕":"\uD83E\uDD16"})]}),(0,n.jsx)("div",{className:"editor-wrapper",children:(()=>{switch(e){case"HTML":return(0,n.jsx)(o,{value:d,onChange:m});case"CSS":return(0,n.jsx)(c,{value:u,onChange:f});case"Data":return(0,n.jsx)(l,{value:h,onChange:g});default:return null}})()})]}),(0,n.jsx)("div",{className:"right-panel",children:(0,n.jsx)(x,{})})]})}}}]);